# ===== [00] WORKFLOW NAME ====================================================
name: ci

# ===== [01] TRIGGERS =========================================================
on:
  push:
  pull_request:

# ===== [02] JOBS =============================================================
jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # ===== [02-01] CHECKOUT ================================================
      - name: Checkout
        uses: actions/checkout@v4

      # ===== [02-02] PYTHON SETUP ============================================
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"
          cache: "pip"

      # ===== [02-03] INSTALL RUNTIME & DEV TOOLS =============================
      - name: Upgrade pip/setuptools/wheel
        run: |
          python -m pip install --upgrade pip setuptools wheel

      - name: Install package (editable)
        run: |
          pip install -e .

      - name: Install dev tools (pinned Ruff)
        run: |
          pip install mypy bandit pytest
          pip install ruff==0.12.9
          pip install types-requests types-PyYAML
          echo "Ruff version:" && ruff --version

      # ===== [02-04] RUFF (AUTO-FIX & CHECK) ======================================
      - name: Ruff - organize imports (auto-fix I001 only)
        run: ruff check . --fix --select I001

      - name: Ruff - format (apply)
        run: ruff format .

      - name: Ruff - lint (verify)
        run: ruff check .

      - name: Ruff - format check (verify)
        run: ruff format --check .

      # ===== [02-05] MYPY ====================================================
      - name: Mypy
        run: mypy .

      # ===== [02-06] BANDIT (SECURITY) ======================================
      - name: Bandit
        run: bandit -q -r .

      # ===== [02-07] TESTS (OPTIONAL) =======================================
      - name: PyTest (optional)
        run: pytest -q || true
